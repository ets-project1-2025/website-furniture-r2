---
import { getMessages, defaultLocale } from '../i18n/config';
import { supabase } from '../lib/supabaseClient';

// Determine locale from URL or default to 'id'
const locale = Astro.url.pathname.startsWith('/en/') ? 'en' : 'id';
const t = getMessages(locale);

// Check session for user
const { data: { session } } = await supabase.auth.getSession();
---

<html lang={locale}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{t['home_title']}</title>
    <meta name="description" content={t['home_description']} />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="/src/styles/global.css" />
  </head>
  <body class="min-h-screen flex flex-col">
    <header class="bg-amber-100 shadow-md py-4 px-6">
      <nav class="flex justify-between items-center">
        <a href={`/${locale !== defaultLocale ? locale : ''}`} class="text-2xl font-bold text-amber-900">WIDI Furniture</a>
        <ul class="flex space-x-6">
          <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}`}>{t['nav_home']}</a></li>
          <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}/products`}>{t['nav_products']}</a></li>
          <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}/about`}>{t['nav_about']}</a></li>
          <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}/contact`}>{t['nav_contact']}</a></li>
          {session ? 
            <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}/profile`}>{t['nav_profile']}</a></li> : 
            <li><a class="text-gray-700 hover:text-amber-800 transition-colors" href={`/${locale !== defaultLocale ? locale : ''}/login`}>{t['nav_login']}</a></li>
          }
          <li>
            <select onchange="window.location = this.value;" class="bg-amber-50 text-gray-700 px-2 py-1 rounded-md">
              <option value="/" {locale === 'id' ? 'selected' : ''}>ID</option>
              <option value="/en" {locale === 'en' ? 'selected' : ''}>EN</option>
            </select>
          </li>
        </ul>
      </nav>
    </header>

    <main class="py-8 px-6 flex-grow">
      <section class="text-center py-12">
        <h2 class="text-4xl font-bold text-amber-900 mb-4">{t['home_welcome']}</h2>
        <p class="text-xl text-gray-700 max-w-2xl mx-auto">{t['home_description']}</p>
      </section>
      
      <section class="py-8">
        <h3 class="text-2xl font-semibold text-amber-900 mb-6 text-center">{t['featured_products']}</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-105">
            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-48" />
            <div class="p-4">
              <h4 class="text-lg font-semibold text-gray-800">Modern Chair</h4>
              <p class="text-amber-700 font-bold mt-2">$199.99</p>
            </div>
          </div>
          
          <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-105">
            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-48" />
            <div class="p-4">
              <h4 class="text-lg font-semibold text-gray-800">Elegant Sofa</h4>
              <p class="text-amber-700 font-bold mt-2">$899.99</p>
            </div>
          </div>
          
          <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-105">
            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-48" />
            <div class="p-4">
              <h4 class="text-lg font-semibold text-gray-800">Designer Table</h4>
              <p class="text-amber-700 font-bold mt-2">$599.99</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-amber-100 py-6 px-6 text-center text-gray-600">
      <p>{t['footer_copyright']} &copy; 2025 WIDI Furniture. All rights reserved.</p>
    </footer>
    
    <script>
      // Update the URL when language is changed
      document.querySelector('select').addEventListener('change', function() {
        window.location = this.value;
      });
    </script>
  </body>
</html>